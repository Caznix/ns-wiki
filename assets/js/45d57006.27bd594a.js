"use strict";(self.webpackChunkns_wiki=self.webpackChunkns_wiki||[]).push([[5024],{8265:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>o});var i=t(4848),r=t(8453);const s={},a="Threads, Signals and Flags {#async-doc}",l={id:"squirrel/async",title:"Threads, Signals and Flags",description:"async-doc}",source:"@site/docs/squirrel/async.md",sourceDirName:"squirrel",slug:"/squirrel/async",permalink:"/ns-wiki/docs/squirrel/async",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/squirrel/async.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"index",permalink:"/ns-wiki/docs/squirrel/"},next:{title:"Classes",permalink:"/ns-wiki/docs/squirrel/class"}},d={},o=[{value:"Threads",id:"threads",level:2},{value:"Spinning off a thread",id:"spinning-off-a-thread",level:3},{value:"wait",id:"wait",level:3},{value:"OnThreadEnd",id:"onthreadend",level:3},{value:"Example Script",id:"example-script",level:3},{value:"Signals and flags",id:"signals-and-flags",level:2},{value:"Signals",id:"signals",level:3},{value:"Example",id:"example",level:4},{value:"Flags",id:"flags",level:3},{value:"Example",id:"example-1",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"async-doc",children:"Threads, Signals and Flags"})}),"\n",(0,i.jsx)(n.h2,{id:"threads",children:"Threads"}),"\n",(0,i.jsx)(n.p,{children:"Squirrel allows scripts to spin off function calls in a thread. All\r\nsubsequential function calls will be threaded as well."}),"\n",(0,i.jsxs)(n.p,{children:["In threaded functions, it's possible to halt a threaded function with\r\n",(0,i.jsx)(n.code,{children:"wait"})," statements, signals, flags and by suspending a thread object."]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the ",(0,i.jsx)(n.code,{children:"IsNewThread()"})," function to determine if the current\r\nfunction is threaded off."]}),"\n",(0,i.jsxs)(n.p,{children:["For more information, check out the ",(0,i.jsx)(n.a,{href:"http://www.squirrel-lang.org/squirreldoc/reference/language/threads.html",children:"squirrel documentation on\r\nthreads"}),"\r\nand ",(0,i.jsx)(n.a,{href:"http://www.squirrel-lang.org/squirreldoc/reference/language/builtin_functions.html#thread",children:"sq functions of\r\nthreads"}),".\r\nSquirrelRe is very similar to vanilla squirrel in this regard."]}),"\n",(0,i.jsxs)(n.p,{children:["A thread is considered finished, after the threaded function returned a\r\nvalue. This may be ",(0,i.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"spinning-off-a-thread",children:"Spinning off a thread"}),"\n",(0,i.jsxs)(n.p,{children:["To create a new coroutine, call a function with the ",(0,i.jsx)(n.code,{children:"thread"})," keyword\r\nbefore."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"thread void function(){}()\r\nthread MyFunction()\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To get a thread object, use the ",(0,i.jsx)(n.code,{children:"newthread"})," function."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'void function CoroutineExample()\r\n{\r\n    suspend( "passback" ) // passback is optional\r\n    print( "threaded statement" )\r\n}\r\n\r\nvar co = newthread( CoroutineExample )\r\nvar suspendedReturn = co.call() // you NEED to use .call, invoking the function with () won\'t work\r\nco.wakeup() // continue thread\n'})}),"\n",(0,i.jsx)(n.h3,{id:"wait",children:"wait"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"wait"})," statement halts threads for a set amount of time specified\r\nafter the ",(0,i.jsx)(n.code,{children:"wait"})," keyword. Integers and floats are accepted as times in\r\nseconds."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"void function WaitExample( float n )\r\n{\r\n    wait 1 // wait 1 second\r\n    wait n // wait n seconds\r\n}\r\n\r\nthread WaitExample( 0.5 ) // thread will halt for a total 1.5 seconds\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To wait a single frame, don't use ",(0,i.jsx)(n.code,{children:"wait 0"})," since it doesn't actually\r\nwait a game frame. For example, if you have a client loop that does wait\r\n0 even if the game is paused the loop will still run. Use ",(0,i.jsx)(n.code,{children:"WaitFrame()"}),"\r\ninstead."]}),"\n",(0,i.jsxs)(n.p,{children:["When using infinite loops it's important to work with ",(0,i.jsx)(n.code,{children:"wait"})," statements\r\nto avoid the game freezing."]}),"\n",(0,i.jsxs)(n.p,{children:["If you want to wait until a thread is finished, you can spin off the\r\nthread that you wait for with the ",(0,i.jsx)(n.code,{children:"waitthread"})," keyword."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'void function ParentThread()\r\n{\r\n    printt( "pre spinoff " + string( Time() ) )\r\n    waitthread void function()\r\n    {\r\n        printt( "mid spinoff " + string( Time() ) )\r\n        wait 1\r\n    }\r\n    printt( "post spinoff" + string( Time() ) )\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"onthreadend",children:"OnThreadEnd"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"OnThreadEnd"})," function to execute a callback after a thread has\r\nended. This is useful for cleanup functions that remove entities after\r\nthey're used or similar."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'void function PlayIncomingFX( vector origin, int teamNum )\r\n{\r\n    wait 1.50\r\n    EmitSoundAtPosition( teamNum, origin, "Titan_1P_Warpfall_Start" )\r\n\r\n    local colorVec = Vector( 0, 255, 0 )\r\n    entity cpoint = CreateEntity( "info_placement_helper" )\r\n    SetTargetName( cpoint, UniqueString( "pickup_controlpoint" ) )\r\n    DispatchSpawn( cpoint )\r\n    cpoint.SetOrigin( colorVec )\r\n    entity glowFX = PlayFXWithControlPoint( INCOMING_SPAWN_FX, origin, cpoint, -1, null, null, C_PLAYFX_LOOP )\r\n\r\n    OnThreadEnd(\r\n        function() : ( glowFX, cpoint )\r\n        {\r\n            if ( IsValid( glowFX ) )\r\n                glowFX.Destroy()\r\n            if ( IsValid( cpoint ) )\r\n                cpoint.Destroy()\r\n        }\r\n    )\r\n\r\n    wait 1.25\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-script",children:"Example Script"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"void function SetPositionDelayed( entity ent, vector pos, float delay )\r\n{\r\n    wait delay\r\n    ent.SetOrigin( pos )\r\n}\r\n\r\nSetPositionDelayed( player, <0, 0, 100>, 5.0 )\r\nSetPositionDelayed( player, <0, 0, 50>, 2.5 ) // this will finish sooner.\n"})}),"\n",(0,i.jsx)(n.h2,{id:"signals-and-flags",children:"Signals and flags"}),"\n",(0,i.jsx)(n.p,{children:"Signals and flags allow threads to wait for events before running some\r\ncode."}),"\n",(0,i.jsx)(n.h3,{id:"signals",children:"Signals"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Registers a Signals to use on any entity. It's required to register\r\nsignals before using them."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"../reference/respawn/entities"})}),"\n",(0,i.jsxs)(n.p,{children:["Trigger a signal on this entity. The passed ",(0,i.jsx)(n.code,{children:"results"})," will be returned\r\nby ",(0,i.jsx)(n.code,{children:"WaitSignal"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Ends this thread when the identifier is signaled on this entity"}),"\n",(0,i.jsx)(n.p,{children:"Halts this thread until a signal is activated for this entity"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Register a callback that executes when the ",(0,i.jsx)(n.code,{children:"signal"})," has been fired\r\non this Entity"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Disconnects the callback from the signal."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Connects an output on this entity to an input on another entity via\r\ncode. The ",(0,i.jsx)(n.code,{children:"target"})," can be a name or a named entity."]}),"\n",(0,i.jsx)(n.p,{children:"Fire a signal on this entity, with optional parm and delay"}),"\n",(0,i.jsx)(n.p,{children:"Fire a signal on this entity, with optional parm and delay\r\n(synchronous)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"It's also possible to trigger and catch signals with methods that\r\naren't properties of an entity."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Trigger a signal on ",(0,i.jsx)(n.code,{children:"ent"}),". The passed ",(0,i.jsx)(n.code,{children:"results"})," will be returned by\r\n",(0,i.jsx)(n.code,{children:"WaitSignal"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Wait for any of the passed signals to be triggered."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'// Wait for the NPC to die, delete, or get leeched, then remove the npc from the array\r\nWaitSignal( ent, "OnDeath", "OnDestroy", "OnLeeched" )\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Ends this thread when the identifier is signaled on ",(0,i.jsx)(n.code,{children:"ent"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"For example, if we want to tell a player not to give up after being\r\nkilled several times, we can write it this way:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'// First, we register signal we want to use\r\nRegisterSignal("OnMultipleDeaths")\r\n\r\n\r\nvoid function WatchForDeaths (entity player) \r\n{\r\n    int deathsCount = 0\r\n\r\n    while( GamePlayingOrSuddenDeath() )\r\n    {\r\n        if ( player.isDead() )  // This doesn\'t exist, don\'t try this at home\r\n        {\r\n            deathsCount += 1\r\n\r\n            if (deathsCount >= 42)\r\n            {\r\n                // This sends "OnMultipleDeaths" signal on player entity\r\n                player.Signal( "OnMultipleDeaths" )\r\n            } \r\n        }\r\n    }\r\n}\r\n\r\n\r\nvoid function DontGiveUp (entity player)\r\n{\r\n    // This is a blocking call\r\n    player.WaitSignal("OnMultipleDeaths");\r\n\r\n    // This will not run until entity received "OnMultipleDeaths" signal\r\n    SendHudMessage( player, "Don\'t give up!", -1, 0.4, 255, 0, 0, 0, 0, 3, 0.15 )\r\n}\r\n\r\n// Launch our methods in dedicated threads\r\nentity player = GetPlayerArray()[0]\r\nthread WatchForDeaths( player )\r\nthread DontGiveUp( player )\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, the ",(0,i.jsx)(n.code,{children:"DontGiveUp"})," method is launched at the same time as\r\n",(0,i.jsx)(n.code,{children:"WatchForDeaths"}),"; but it will not run until player died 42 times."]}),"\n",(0,i.jsxs)(n.p,{children:["When you want your thread to die on a given event, you can use\r\n",(0,i.jsx)(n.code,{children:'entity.EndSignal( "OnMultipleDeaths" )'}),"; when said signal is set,\r\nthread will end (after calling any OnThreadEnd methods)."]}),"\n",(0,i.jsx)(n.h3,{id:"flags",children:"Flags"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Flags"})," work pretty much the same way as ",(0,i.jsx)(n.code,{children:"Signals"}),", except they can be\r\nset up without target entity:"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Create a flag"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Halts a thread until a flag is set. Callee must be threaded off."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Halts until every passed flag is set. Callee must be threaded off."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Halts until the passed flag is set or the timer runs out. Callee must\r\nbe threaded off."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Raise a flag"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.code,{children:"flagset"})," after ",(0,i.jsx)(n.code,{children:"flagwait"})," is set and the delay is met."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Reset a flag"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Resets all passed flags."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Reset ",(0,i.jsx)(n.code,{children:"flagclear"})," when ",(0,i.jsx)(n.code,{children:"flagwait"})," is set."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Resets a flag after the timer runs out."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Wait until any passed flag is cleared."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Raise a flag if it is reset, or reset it if it's raised."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Ends this thread when the flag is set"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Returns the current state of a flag."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Returns ",(0,i.jsx)(n.code,{children:"true"})," if the flag is initialized"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Splits the flag on ",(0,i.jsx)(n.code,{children:'" "'})]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Splits the value of the keyvalues of the entity on the index ",(0,i.jsx)(n.code,{children:"field"}),"\r\non ",(0,i.jsx)(n.code,{children:'" "'})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"example-1",children:"Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'void function FlagExample()\r\n{\r\n    FlagInit( "BombHasExploded" )\r\n\r\n    thread BombTicker()\r\n\r\n    FlagWait( "BombHasExploded" )\r\n    print( "bomb just exploded" )\r\n}\r\n\r\nvoid function BombTicker()\r\n{\r\n    Assert( IsNewThread(), "BombTicker must be threaded off" )\r\n    wait RandomFloatRange( 3, 9 )\r\n    FlagSet( "BombHasExploded" )\r\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var i=t(6540);const r={},s=i.createContext(r);function a(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);